<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="DAWIEANG Phudis">
    <meta name="description" content="Cafe Stile is opening for ordering cake right now!">
    <meta name="keywords" content="stile, cake">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order page!</title>
    <link rel="stylesheet" href="../css/commonCSS.css" type = "text/css" media="all">
    <link rel="stylesheet" href="../css/order.css" type="text/css" media="all">
  </head>
  <body onload = "init()">
    <div class = "header">
      <div class="logo">
        <img src = "../img/logo.png" alt = "logo"/>
        <h3>Stile</h3>
      </div>
      <div class="TopBanner">
        <h2> Smile, sweet, sister, sadistic, surprise, service </h2>
        <h1>WE ARE STILE</h1>
      </div>
    </div>
    <div class="navigation">
      <div class="icon">
        <img src = "../img/viewlist.png" alt="viewlist">
        <nav class="menu">
          <a href="index.html">HOME</a>
          <a href="order.html">ORDER</a>
          <a href ="about.html">DESIGN</a>
          <!--<a href ="secret.html">-->
          <a href="#">SECRET</a>
        </nav>
      </div>
    </div>

    <div class="content">
      <div id="dimmer">
        <div id="error"></div>
      </div>

      <div class="cake-images"> </div>
      <div class="cake_order">
        <form action="print.html" method="get" onsubmit="return isValid()">
          <fieldset>
            <legend>Order Information</legend>
            <label for="tel-no" class="textans">Telephone No.</label>
            <input type="text" name="tel-no" id="tel-no" value="85212561" onchange="invoice_change(this.value)">
            <label for="pick-date" class="textans">Pick Up Date</label>
            <input type="text" name="pick-date" id="pick-date" value="mm/dd/yy">
            <label for="delivery">Delivery</label>
            <input type="radio" id = "delivery" class = "radio" name="method" value="delivery">
            <label for="pickup">Pick up</label>
            <input type="radio" id = "pickup" class="radio" name="method" value="pickup">
            <br>
            <table id = "order_table" >
              <caption >Order No. <span id="invoice_no">26234563</span></caption>
              <thead>
                <tr>
                  <th>Cake Name</th>
                  <th>Qty</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
              <tfoot>
                <tr>
                  <td>Total</td>
                  <td>0</td>
                </tr>
              </tfoot>
            </table>
            <input type="submit" name="submit" value="Print Invoice">
          </fieldset>
        </form>
      </div>
    </div>
    <footer>
      <hr>
      <h4>Â© CityU 2017 sources of images and text from Wikipedia & courtesy of all-free-download.com</h4>
      <h4>Published by DAWIEANG Phudis</h4>
      <nav>
      <a href="index.html">HOME</a>
      <a href="order.html">ORDER</a>
      <a href ="about.html">DESIGN</a>
      <a href ="#">SECRET</a>
      </nav>

    </footer>
    <script type="text/javascript" src="../JS/cakemenu.js"></script>
    <script type="text/javascript" src="../JS/fillform.js"></script>
    <script type="text/javascript">
    var cake_all;
    var error="";
    function onclicked(cake_id)
    {
      var order_table = document.querySelector('#order_table');
      var row_amount = order_table.rows.length;

      var amount;
      do{
        var amount = prompt('How many ' + cake_id +'(s) you want to buy?');
      }
      while(isNaN(amount));

      if(checkEmpty(amount) || amount == 0)
      {
        alert("Order unsucessful!");
        return;
      }
      var order_table_body = order_table.querySelector('tbody');
      var row_amount_body = order_table_body.rows.length;
      alert("You ordered " + amount + " "+cake_id + "(s) !");
      var newrow = order_table_body.insertRow(row_amount_body);
      var newcake = newrow.insertCell(0);
      var newamount = newrow.insertCell(1);
      newamount.innerHTML = amount;
      newcake.innerHTML = cake_id;
      order_table.rows[row_amount].cells[1].innerHTML =Number(order_table.rows[row_amount].cells[1].innerHTML) + Number(newamount.innerHTML);
    }
    function invoice_change(new_num)
    {
      var invoice_no = document.querySelector('#invoice_no');
      invoice_no.innerHTML = new_num;
    }

    function checkEmpty(str)
    {
      if(str==null||str.trim().length ==0 ||str.trim() =="")
        return true;
      return false;
    }
    function isValid(){
      var error ="";
      var invoice_tel = document.querySelector('#tel-no').value;
      var invoice_date = document.querySelector('#pick-date').value;
      var invoice_radio_delivery = document.querySelector('#delivery').checked;
      var invoice_radio_pickup = document.querySelector('#pickup').checked;
      var isOkay= true;
      if(checkEmpty(invoice_tel))
      {
        error +=" No Telephone and Invoice number.";
        isOkay = false;
      }
      if(checkEmpty(invoice_date))
      {
        error +=" No invoice date.";
        isOkay = false;
      }
      if(!(invoice_radio_delivery || invoice_radio_pickup))
      {
        error +=" No method (delivery/pickup) selected."
        isOkay = false;
      }
      error = error.substring(1);

      if(isOkay)
      {
        var order_table_body = order_table.querySelector('tbody');
        var row_amount_body = order_table_body.rows.length;
        var cake_name = [];
        for(var i=0;i<row_amount_body;i++)
        {
          cake = order_table_body.rows[i];
          var str = cake.cells[0].innerHTML;
          cake_name.push(str);
          localStorage.setItem(str,cake.cells[1].innerHTML);
        }
        localStorage.setItem("name",JSON.stringify(cake_name));
        return true;
      }
      else{
        document.querySelector("#error").innerHTML = error;
        document.querySelector("#error").style.display="block";
        document.querySelector("#dimmer").style.display = "block";
        return false;
      }
    }
    function init()
    {
      query();
      var invoice = document.querySelector('#invoice_no');
      invoice_change(document.querySelector('#tel-no').value); //change invoice no.
      cake_all = initMenu(); //cake_all filled here
      var img_length = cake_all.length;
      var cake_img = document.querySelector('.cake-images');
      for(var i=0;i<img_length;i++)
      {
        var img_append = document.createElement("img");
        img_append.src = '../img/' +cake_all[i].imagefile;
        img_append.title = cake_all[i].description;
        img_append.alt = cake_all[i].description;
        cake_img.append(img_append);
      }
      var all_cake_img = document.querySelectorAll('.cake-images img');
      var name;
      for(var i=0;i<img_length;i++)
      {
        all_cake_img[i].addEventListener("click",function(){
          onclicked(this.title);
        });
        //alert("add" + all_cake_img[i].alt +'\n');
      }
      document.addEventListener("click", function(event){
        if(event.target.closest("#error"))
        {
          return;
        }
        document.querySelector("#error").style.display="none";
        document.querySelector("#dimmer").style.display = "none";
      });
    }
    </script>
  </body>

</html>
